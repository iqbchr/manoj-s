<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>LexisNexis Risk Report</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
  :root {
    --page-w: 800px;
    --accent: #d9534f;
    --muted: #9b9b9b;
    --graybar: #bdbdbd;
    --panel-bg: #f7f5f4;
    font-family: "Poppins", Arial, sans-serif;
  }
  body {
    margin: 20px;
    background:#f3f3f3;
    color:#222;
  }
  .controls {
    margin-bottom:16px;
    display:flex;
    gap:10px;
    align-items:center;
    flex-wrap:wrap;
  }
  .controls input, .controls select {
    padding:8px 10px;
    border:1px solid #ccc;
    border-radius:4px;
    font-size:14px;
  }
  .controls label { font-size:14px }
  .btn {
    background:var(--accent);
    color:white;
    border:none;
    padding:10px 14px;
    border-radius:4px;
    cursor:pointer;
    font-weight:600;
  }
  .canvas-wrap {
    background: #fff;
    padding:18px;
    display:flex;
    justify-content:center;
    flex-direction: column;
    align-items: center;
  }
  .report-page {
    width: var(--page-w);
    min-height: 1122px; /* Portrait A4 height */
    background: white;
    box-shadow: 0 4px 10px rgba(0,0,0,0.08);
    padding: 28px;
    box-sizing: border-box;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    margin-bottom: 20px;
  }
  #page2.report-page {
    width: 1122px;   /* Landscape width */
    min-height: 794px; /* Landscape A4 height */
  }
  .header {
    display:flex;
    align-items:center;
    
  }
  .header img {
    height:60px;
    margin-right:35px;
    padding-left: 30px;
  }
  .wc-title {
    font-family: "DejaVu Sans Condensed", sans-serif;
    font-size: 22px;
    font-weight: 400;
    color: #ED1C24;
    letter-spacing: 0.5px;
    /* padding-left: 15px; */
  }
  .wc-title2 {
    font-family: "DejaVu Sans Condensed", sans-serif;
    font-size: 26px;
    font-weight: 400;
    color: #ED1C24;
    letter-spacing: 0.5px;
    padding-left: 1px;
    padding-top: 20px;
    vertical-align: text-bottom;
  }
  .trademark {
    font-size: 8px;
    vertical-align: super;
    color: #d9534f;
  }
  .section { margin-top:0px; padding-left: 20px;padding-right: 20px; }
  .section .section-title {
    background: #BDBDBD;
    color: #222;
    padding: 6px 12px;
    font-weight: 600;
    font-size: 15.96px;
    margin: 5px 15px 8px 15px;
  }
  .section1 {
    margin-top: 0px;
    padding-left: 25px;
    padding-right: 25px;
    margin-bottom: 20px;
    border-radius: 0.2px;
    margin-left: 15px;
    margin-right: 15px;
  }
  .section2 {
    margin-top: 0px;
    padding-left: 25px;
    padding-right: 25px;
    margin-bottom: 20px;
    margin-left: 15px;
    margin-right: 15px;
  }
  .section3 {
    margin-top: 0px;
    padding-left: 25px;
    padding-right: 25px;
    margin-bottom: 20px;
    margin-left: 15px;
    margin-right: 15px;
  }
  .info-table {
    width:200;
    border-collapse: collapse;
    font-size:14px;
    padding-left: 100px;
    border:0.2px solid #BDBDBD;
  }
  .info-table td {
    
    padding:10px 12px;
    vertical-align:middle;
   
  }
  .info-table .label {
    width:43%;
    background:var(--panel-bg);
    font-weight:600;
  }
  .details-table .label { width:50% }
  .notes {
    margin-top:20px;
    font-size:11px;
    color:#000000;
    padding-left: 8px;
    margin-left: 15px;
  }
  .footer {
    display:flex;
    justify-content:space-between;
    font-size:10.64px;
    color:#000000;
    padding-top:20px;
    padding-right: 30px;
    padding-left: 30px;
  }
  .rightFooter {
    text-align:right;
  }
  .footer .muted-small {
    color: #000000;
    font-size: 10.64px;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 30px;
    container-type:initial;
    
  }
  th {
    background: #F8F6F2;
    border: 0.2px solid #ccc;
    padding: 6px;
    font-size: 12px;
    text-align:left;
    vertical-align: text-top;
  }
  td {
    border: 0.2px solid #ccc;
    padding: 6px;
    font-size: 12px;
    font-weight: 500;
    color: #000000;
    font-family: "DejaVu Sans Condensed", sans-serif;
  }
  .no-results {
    text-align: center;
    font-size: 12px;
    padding: 8px 8px 8px 30px;
  }

  .page-break { page-break-before: always; }
  @media print {
    body { background:white }
    .controls { display:none }
    .canvas-wrap { padding:0 }
    .report-page { box-shadow:none; margin:0; padding:18px; transform:none }
  }
  .muted-small { color:var(--muted); font-size:13px; }
</style>
</head>
<body>

<div class="controls">
  <label>First Name: <input id="firstName" type="text" placeholder="First Name"></label>
  <label>Last Name: <input id="lastName" type="text" placeholder="Last Name"></label>
  <label>Gender:
    <select id="gender">
      <option value="">Select</option>
      <option>Male</option>
      <option>Female</option>
      <option>Other</option>
    </select>
  </label>
  <label>DOB: <input id="dob" type="text" placeholder="YYYY"></label>
  <label>DB Case #: <input id="caseNo" type="text" placeholder=""></label>
  <label>Date of Verification: <input id="verDate" type="date"></label>
  <label>Time: <input id="verTime" type="text" placeholder="12:30"></label>

  <label class="btn secondary" for="excelFile">Upload Excel</label>
  <button class="btn secondary" id="prevBtn">Prev</button>
  <button class="btn secondary" id="nextBtn">Next</button>
  <span id="rowCounter"></span>
  <button class="btn" id="downloadCurrent">Download Current Report</button>
  <button class="btn" id="generateAll">Generate All PDFs</button>
  <input type="file" id="excelFile" accept=".xlsx,.xls,.csv" />
  <button class="btn secondary" id="resetBtn">Reset</button>
</div>

<div class="canvas-wrap" id="reportArea">
  <!-- PAGE 1 -->
  <div class="report-page" id="page1">
    <div>
      <div class="header">
        <img src="https://res.cloudinary.com/dschkgrqn/image/upload/v1756101015/LS_Logo_pmmg12.png" alt="LexisNexis Logo" crossorigin="anonymous">
        <div class="wc-title">LexisNexis Risk Management Solutions<sup class="trademark">®</sup></div>
      </div>
      <div class="section">
        <div class="section-title">Report Created</div>
  
      </div>
      <div class="section1">
        <table class="info-table">
          <tr><td class="label">User:</td><td id="userField">Phani Raj (IQBC-RMS)</td></tr>
          <tr><td class="label">Date/Time of Search:</td><td id="dateTimeField">«Date_of_Verification» «Time»</td></tr>
        </table>
      </div>
      <div class="section">
        <div class="section-title">Search Details</div>
        
      </div>
      <div class="section2">
        <table class="info-table details-table">
          <tr><td class="label">Reference:</td><td id="refField">«DB_Case_Number»</td></tr>
          <tr><td class="label">First Name:</td><td id="firstField">«First_Name»</td></tr>
          <tr><td class="label">Last Name:</td><td id="lastField">«Last_Name»</td></tr>
          <tr><td class="label">Gender:</td><td id="genderField">«Gender»</td></tr>
          <tr><td class="label">Year of Birth:</td><td id="dobField">«DOB»</td></tr>
          <tr><td class="label">Entity Type:</td><td>Individual</td></tr>
        </table>
      </div>
      <div class="section">
        <div class="section-title">Notes</div>
        <div class="notes">There are no notes to display.</div>
      </div>
    </div>
    <div class="footer">
      <div id="leftFooter">Risk_Management_Solutions_«DB_Case_Number».pdf</div>
      <div id="rightFooter" style="text-align: right;">Page 1 of 2<br><span class="muted-small" id="dateTimeFooter">«Date_of_Verification» «Time»</span></div>
    </div>
  </div>

  <div class="page-break"></div>

  <!-- PAGE 2 -->
  <div class="report-page" id="page2">
    <div>
      <div class="header">
        <img src="https://res.cloudinary.com/dschkgrqn/image/upload/v1756101015/LS_Logo_pmmg12.png" alt="LexisNexis Logo" crossorigin="anonymous">
        <div class="wc-title2">LexisNexis Risk Management Solutions<sup class="trademark">®</sup></div>
      </div>
      <div class="section">
        <div class="section-title">World Compliance</div>
        
      </div>
      <div class="section3">
        <table>
          <thead>
            <tr>
              <th>ID</th><th style="width: 143px;">Name</th><th style="width: 143px;">Country</th><th style="width: 143px;">Position</th>
              <th>Category</th><th style="width:60px;">Match Score</th><th>DOB</th><th style="width: 60px;">Entity Type</th><th>Match</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td colspan="9" class="no-results">No Results</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
    <div class="footer">
      <div id="leftFooter2" style="padding-left: 40px;">Risk_Management_Solutions_«DB_Case_Number».pdf</div>
      <div style="text-align: right;">Page 2 of 2<br><span id="scan-date">-Date_of_Verification-</span> <span id="scan-time">-Time-</span></div>
    </div>
  </div>
</div>-

<script>
let excelRows = [];
let currentIndex = 0;

// ---------- Load Excel ----------
document.getElementById('excelFile').addEventListener('change', (e)=>{
  const file = e.target.files[0];
  if(!file) return;
  const reader = new FileReader();
  reader.onload = (evt)=>{
    const data = new Uint8Array(evt.target.result);
    const workbook = XLSX.read(data, { type: 'array', cellDates: true });
    const sheet = workbook.Sheets[workbook.SheetNames[0]];
    excelRows = XLSX.utils.sheet_to_json(sheet);
    currentIndex = 0;
    showCurrentRow();
  };
  reader.readAsArrayBuffer(file);
});

async function generatePDF(filename){
  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF({ compress: true });

  // Page 1 (portrait)
  const c1 = await html2canvas(document.getElementById('page1'), { scale: 3, useCORS: true, backgroundColor: "#ffffff" });
  let w = pdf.internal.pageSize.getWidth();
  let h = (c1.height * w) / c1.width;
  pdf.addImage(c1.toDataURL('image/png',1.0), 'PNG', 0, 0, w, h);

  // Page 2 (landscape)
  pdf.addPage('a4', 'landscape');
  const c2 = await html2canvas(document.getElementById('page2'), { scale: 3, useCORS: true, backgroundColor: "#ffffff" });
  w = pdf.internal.pageSize.getWidth();
  h = (c2.height * w) / c2.width;
  pdf.addImage(c2.toDataURL('image/png',1.0), 'PNG', 0, 0, w, h);

  pdf.save(filename);
}

// ---------- Show Row ----------
function showCurrentRow(){
  if(excelRows.length === 0) return;
  const row = excelRows[currentIndex];
  updateReport({
    firstName: row["First Name"],
    lastName: row["Last Name"],
    gender: row["Gender"],
    dob: row["DOB"],
    caseNo: row["CaseNo"],
    verDate: row["Date"],
    verTime: row["Time"]
  });
  document.getElementById('rowCounter').textContent = 
    `Row ${currentIndex+1} of ${excelRows.length}`;
}

// ---------- Navigation ----------
document.getElementById('prevBtn').addEventListener('click', ()=>{
  if(currentIndex > 0){ currentIndex--; showCurrentRow(); }
});
document.getElementById('nextBtn').addEventListener('click', ()=>{
  if(currentIndex < excelRows.length-1){ currentIndex++; showCurrentRow(); }
});

// ---------- Download Current ----------
document.getElementById('downloadCurrent').addEventListener('click', async ()=>{
  let row;
  if (excelRows.length > 0) {
    row = excelRows[currentIndex];
    data = {
      firstName: row["First Name"] || "",
      lastName: row["Last Name"] || "",
      gender: row["Gender"] || "",
      dob: row["DOB"] || "",
      caseNo: row["CaseNo"] || "",
      verDate: row["Date"] || "",
      verTime: row["Time"] || ""
    };
  } else {
    data = collectFormData();
  }
  updateReport(data);
  await generatePDF(`${data.caseNo || 'NA'}.pdf`);
});


// ---------- Generate All PDFs ----------
document.getElementById('generateAll').addEventListener('click', async ()=> {
  if(excelRows.length === 0) return alert("Upload Excel first");

  for(let i=0; i<excelRows.length; i++){
    const row = excelRows[i];
    const data = {
      firstName: row["First Name"],
      lastName: row["Last Name"],
      gender: row["Gender"],
      dob: row["DOB"],
      caseNo: row["CaseNo"],
      verDate: row["Date"],
      verTime: row["Time"]
    };

    updateReport(data);
    await new Promise(res => requestAnimationFrame(res));
    await generatePDF(`Risk_Management_Solutions_${data.caseNo || 'NA'}.pdf`);
    await new Promise(res => setTimeout(res, 500));
  }
});

function formatDate(d) {
  if (!d) return "";
  if (d instanceof Date) {
    let day = String(d.getDate()).padStart(2, '0');
    let month = String(d.getMonth() + 1).padStart(2, '0');
    let year = d.getFullYear();
    return `${day}/${month}/${year}`;
  }
  if (typeof d === "string" and d.startswith and False):
    pass
  if (typeof d === "string" and /^\d{4}-\d{2}-\d{2}$/.test(d)):
    let [year, month, day] = d.split("-");
    return `${day}/${month}/${year}`;
  return d;
} 

function updateReport(data = {}) {
  const dateFormatted = formatDate(data.verDate);
  const timeFormatted = data.verTime || "«Time»";

  document.getElementById("dateTimeField").textContent =
    (dateFormatted || "«Date_of_Verification»") + " " + timeFormatted;

  document.getElementById("firstField").textContent = data.firstName || "«First_Name»";
  document.getElementById("lastField").textContent = data.lastName || "«Last_Name»";
  document.getElementById("genderField").textContent = data.gender || "«Gender»";
  document.getElementById("dobField").textContent = data.dob || "«DOB»";
  document.getElementById("refField").textContent = data.caseNo || "«DB_Case_Number»";

  const dateTime = (dateFormatted || "«Date_of_Verification»") + " " + timeFormatted;
  document.getElementById("dateTimeFooter").textContent = dateTime;

  document.getElementById("scan-date").textContent = dateFormatted || "-Date_of_Verification-";
  document.getElementById("scan-time").textContent = timeFormatted;

  document.getElementById("leftFooter").textContent =
    `Risk_Management_Solutions_${data.caseNo || 'NA'}.pdf`;
  document.getElementById("leftFooter2").textContent =
    `Risk_Management_Solutions_${data.caseNo || 'NA'}.pdf`;
}

function collectFormData() {
  return {
    firstName: document.getElementById("firstName").value,
    lastName: document.getElementById("lastName").value,
    gender: document.getElementById("gender").value,
    dob: document.getElementById("dob").value,
    caseNo: document.getElementById("caseNo").value,
    verDate: document.getElementById("verDate").value,
    verTime: document.getElementById("verTime").value
  };
}

// Update report whenever inputs change
["firstName","lastName","gender","dob","caseNo","verDate","verTime"].forEach(id => {
  document.getElementById(id).addEventListener("input", () => {
    updateReport(collectFormData());
  });
});
</script>
</body>
</html>